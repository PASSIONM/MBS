<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="V1_Store">
	<select id="selectStoreOne" parameterType="int" resultType="V1_Store">
		SELECT * FROM `store` WHERE str_number=#{str_number}
	</select>
	
	<select id="selectMenuList" parameterType="int" resultType="V1_Menu">
		SELECT * FROM `str_menu` WHERE str_number=#{str_number}
	</select>
	
	<resultMap type="V1_StrImg" id="resultImg" >
		<result column="str_image" property="str_image" jdbcType="BLOB"/>
	</resultMap>
	<select id="selectBlobImg" parameterType="V1_StrImg" resultMap="resultImg">
		SELECT str_image FROM `str_image` WHERE str_number=#{str_number} AND str_image_idx=#{str_image_idx}
	</select>
	
	<insert id="insertImgs" parameterType="V1_StrImg">
		INSERT INTO `str_image` (str_image, str_number, str_image_idx, str_img_date)
		VALUES(#{str_image, jdbcType=BLOB}, #{str_number}, #{str_image_idx}, NOW()) 
	</insert>
	
	<select id="selectImgCount" parameterType="int" resultType="int">
		SELECT COUNT(*) AS cnt FROM `str_image` WHERE str_number=#{str_number}
	</select>
	
	<select id="selectMemberOne" parameterType="String" resultType="V1_Member">
		SELECT * FROM `member` WHERE mb_id=#{mb_id}
	</select>
	
	<insert id="insertReservation" parameterType="V1_Reservation">
		INSERT INTO `reservation` (rsv_day, rsv_time, rsv_personnel, rsv_sub_id, rsv_sub_name, rsv_sub_tel, rsv_sub_email, rsv_sub_request, str_number, rsv_date)
		VALUES(#{rsv_day}, #{rsv_time}, #{rsv_personnel}, #{rsv_sub_id}, #{rsv_sub_name}, #{rsv_sub_tel}, #{rsv_sub_email}, #{rsv_sub_request}, #{str_number}, NOW())
	</insert>
	
	<select id="selectRsvList" parameterType="String" resultType="V1_Reservation">
		SELECT * FROM `reservation` WHERE rsv_sub_id=#{rsv_sub_id} ORDER BY rsv_no DESC
	</select>
	
	<select id="selectRsvOne" parameterType="int" resultType="V1_Reservation">
		SELECT s.str_name, s.str_tel, s.str_address, r.rsv_no, r.rsv_day, r.rsv_time, r.rsv_personnel, r.rsv_sub_id, r.rsv_sub_name, r.rsv_sub_tel, r.rsv_sub_email, r.rsv_sub_request, r.str_number
		FROM `reservation` r 
			INNER JOIN `store` s
			ON r.str_number = s.str_number
		WHERE r.rsv_no=#{rsv_no}
	</select>
	
	
</mapper>